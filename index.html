<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>학원 검색 & 폭파 웹 서비스</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { height: 500px; width: 100%; position: relative; }
        #search-form { padding: 10px; text-align: center; }
        #explode-btn { display: none; margin-top: 10px; padding: 10px; background: red; color: white; border: none; cursor: pointer; }
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 1000; } /* Canvas 오버레이 */
    </style>
</head>
<body>
    <div id="search-form">
        <input type="text" id="search-input" placeholder="학원 이름이나 주소 입력 (e.g., 서울 학원)" style="width: 300px; padding: 10px;">
        <button id="search-btn" onclick="searchAcademy()">검색</button>
        <button id="explode-btn" onclick="explodeAcademy()">학원 폭파!</button>
    </div>
    <div id="map"></div>
    <canvas id="explosion-canvas"></canvas>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 지도 초기화 (Leaflet.js + OpenStreetMap)
        var map = L.map('map').setView([37.5665, 126.9780], 13); // 서울 중심
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var marker; // 학원 마커
        var academyLatLng; // 학원 위치 저장

        // 검색 함수 (Nominatim API 사용)
        function searchAcademy() {
            var query = document.getElementById('search-input').value;
            fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1&email=your@email.com`) // email은 실제로 바꾸세요
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        var lat = parseFloat(data[0].lat);
                        var lon = parseFloat(data[0].lon);
                        academyLatLng = [lat, lon];
                        map.setView(academyLatLng, 15);
                        
                        if (marker) marker.remove();
                        marker = L.marker(academyLatLng).addTo(map)
                            .bindPopup(data[0].display_name)
                            .openPopup();
                        
                        document.getElementById('explode-btn').style.display = 'block';
                    } else {
                        alert('학원을 찾지 못했어요. 더 구체적으로 검색해보세요!');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // 폭파 효과 (Canvas 애니메이션)
        function explodeAcademy() {
            var canvas = document.getElementById('explosion-canvas');
            var ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // 학원 위치를 Canvas 좌표로 변환 (지도 좌표 -> 화면 좌표)
            var point = map.latLngToContainerPoint(academyLatLng);
            var centerX = point.x;
            var centerY = point.y + document.getElementById('search-form').offsetHeight; // 검색 바 높이 보정

            // 파티클 배열 (폭발 입자)
            var particles = [];
            for (var i = 0; i < 100; i++) {
                particles.push({
                    x: centerX,
                    y: centerY,
                    vx: Math.random() * 10 - 5, // 랜덤 속도
                    vy: Math.random() * 10 - 5,
                    radius: Math.random() * 5 + 2,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`, // 랜덤 색상
                    life: 100 // 수명
                });
            }

            // 애니메이션 루프
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    if (p.life > 0) {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.fill();
                        
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.1; // 중력 효과
                        p.life -= 2; // 수명 감소
                        p.radius *= 0.98; // 크기 줄임
                    }
                });
                
                if (particles.some(p => p.life > 0)) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height); // 끝나면 지우기
                }
            }
            animate();
        }
    </script>
</body>
</html>